
Generate SQL
CREATE TABLE BUSES
(  PLACA INT NOT NULL,
  CAPACIDAD INT NOT NULL,
  MODELO INT NOT NULL,
  PRIMARY KEY (PLACA));
ALTER TABLE BUSES ADD CONSTRAINT CH_CAP CHECK (CAPACIDAD>=10);
ALTER TABLE BUSES ADD CONSTRAINT CH_PLACA CHECK (PLACA>0);
ALTER TABLE BUSES ADD CONSTRAINT CH_MOD CHECK (MODELO>0);
MODELO=<0

CREATE TABLE RUTAS
(  COD_R INT NOT NULL,
  NOMB_R VARCHAR(30) NOT NULL,
  HORA_SALIDA TIME NOT NULL,
  PRIMARY KEY (COD_R));

ALTER TABLE RUTAS ADD CONSTRAINT CH_COD_R CHECK (COD_R>0);
ALTER TABLE RUTAS ADD CONSTRAINT check_hora_salida CHECK (hora_salida >= '05:00:00' AND hora_salida <= '19:00:00');


CREATE TABLE PARADEROS
( COD_P INT NOT NULL,
  NOMB_P VARCHAR(30) NOT NULL,
  Direccion VARCHAR(30) NOT NULL,
  PRIMARY KEY (COD_P));
ALTER TABLE PARADEROS ADD CONSTRAINT CH_COD_P CHECK (COD_P>0);

CREATE TABLE CONDUCTORES
(EDAD_calculada INT NOT NULL,
  NOMB_C VARCHAR(30) NOT NULL,
  APE_C VARCHAR(30) NOT NULL,
  CEDULA INT NOT NULL,
  fecha_nacimiento date NOT NULL;
  PRIMARY KEY (CEDULA));
ALTER TABLE CONDUCTORES ADD CONSTRAINT CH_EDAD CHECK (EDAD>=18);
ALTER TABLE CONDUCTORES ADD CONSTRAINT CH_CED CHECK (CEDULA>0);

CREATE OR REPLACE FUNCTION calc_edad()
RETURNS TRIGGER AS $$
DECLARE
  fecha_actual timestamp;
  diferencia interval;
BEGIN
  fecha_actual := NOW();
  diferencia := fecha_actual - NEW.fecha_nacimiento;

  NEW.edad_calculada := 
    (date_part('year', diferencia) * 365.25 + 
     date_part('month', diferencia) * 30.4375 + 
     date_part('day', diferencia));

  RETURN NEW;
END;
$$ LANGUAGE plpgsql;


CREATE TRIGGER calc_edad_trigger
BEFORE INSERT OR UPDATE ON conductores
FOR EACH ROW
EXECUTE FUNCTION calc_edad();


CREATE TABLE MANEJAN
(fecha_i DATE NOT NULL,
  fecha_f DATE NOT NULL,
  PLACA INT NOT NULL,
  CEDULA INT NOT NULL,
  PRIMARY KEY (fecha_f,fecha_i,PLACA,CEDULA));

ALTER TABLE MANEJAN ADD CONSTRAINT FK_BUS FOREIGN KEY (PLACA) REFERENCES BUSES(PLACA);
ALTER TABLE MANEJAN ADD CONSTRAINT FK_CED FOREIGN KEY (CEDULA) REFERENCES CONDUCTORES(CEDULA);
ALTER TABLE MANEJAN ADD CONSTRAINT CH_FEC CHECK (FECHA_I<FECHA_F);

CREATE TABLE CUBREN
(fecha DATE NOT NULL,
  PLACA INT NOT NULL,
  COD_R INT NOT NULL, 
  PRIMARY KEY (fecha,PLACA,COD_R));

ALTER TABLE CUBREN ADD CONSTRAINT FK_PLACA FOREIGN KEY (PLACA) REFERENCES BUSES(PLACA);
ALTER TABLE CUBREN ADD